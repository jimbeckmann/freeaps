var freeaps_determineBasal;(()=>{var e={4635:(e,a,t)=>{var r=t(6880);function n(e,a){a||(a=0);var t=Math.pow(10,a);return Math.round(e*t)/t}function o(e,a){return"mmol/L"===a.out_units?n(e/18,1):Math.round(e)}e.exports=function(e,a,t,i,s,l,m,u,d,c,g,h,p){var f,v,b,B=0,M="",_="",x=0,y=0,C=0,w=0,S=0,G=0;function D(e,a){var t=e.getTime();return new Date(t+36e5*a)}function T(e){var a=i.bolus_increment;.05!=a&&(a=.1);var t=e/a;return t>=1?n(Math.floor(t)*a,5):0}function O(e){function a(e){return e<10&&(e="0"+e),e}return a(e.getHours())+":"+a(e.getMinutes())+":00"}function U(e,a){var t=new Date("1/1/1999 "+e),r=new Date("1/1/1999 "+a);return(t.getTime()-r.getTime())/36e5}function R(e,a){var t=0,r=a,n=(e-a)/36e5,o=0,i=n,s=0;do{if(n>0){var l=O(r),m=p[0].start;for(let e=0;e<p.length;e++){var u=p[e].start;if(l==u){if(e+1<p.length){n>=(s=U(p[e+1].start,p[e].start))?o=s:n<s&&(o=n)}else if(e+1==p.length){let a=p[0].start;n>=(s=24-U(p[e].start,a))?o=s:n<s&&(o=n)}t+=T((m=p[e].rate)*o),n-=o,console.log("Dynamic ratios log: scheduled insulin added: "+T(m*o)+" U. Bas duration: "+o.toPrecision(3)+" h. Base Rate: "+m+" U/h. Time :"+l),r=D(r,o)}else if(l>u)if(e+1<p.length){var d=p[e+1].start;l<d&&(n>=(s=U(d,l))?o=s:n<s&&(o=n),t+=T((m=p[e].rate)*o),n-=o,console.log("Dynamic ratios log: scheduled insulin added: "+T(m*o)+" U. Bas duration: "+o.toPrecision(3)+" h. Base Rate: "+m+" U/h. Time :"+l),r=D(r,o))}else if(e==p.length-1){n>=(s=U("23:59:59",l))?o=s:n<s&&(o=n),t+=T((m=p[e].rate)*o),n-=o,console.log("Dynamic ratios log: scheduled insulin added: "+T(m*o)+" U. Bas duration: "+o.toPrecision(3)+" h. Base Rate: "+m+" U/h. Time :"+l),r=D(r,o)}}}}while(n>0&&n<i);return t}let A=g.length;var I,F,P=new Date(g[A-1].timestamp),j=new Date(g[0].timestamp);("TempBasalDuration"==g[0]._type&&(j=new Date),(B=(j-P)/36e5)<23.5)?(S=R(P,(I=24-B,F=P.getTime(),new Date(F-36e5*I))),M="24 hours of data is required for an accurate tdd calculation. Currently only "+B.toPrecision(3)+" hours of pump history data are available. Using your pump scheduled basals to fill in the missing hours. Scheduled basals added: "+S.toPrecision(5)+" U. "):M="";for(let e=0;e<g.length;e++)"Bolus"==g[e]._type&&(w+=g[e].amount);for(let e=1;e<g.length;e++)if("TempBasal"==g[e]._type&&g[e].rate>0){x=e,G=g[e].rate;var q=g[e-1]["duration (min)"]/60,E=q,W=new Date(g[e-1].timestamp);do{if(e--,e<=0){morePresentTime=new Date;break}if("TempBasal"==g[e]._type||"PumpSuspend"==g[e]._type){morePresentTime=new Date(g[e].timestamp);break}}while(e>=0);var k=(morePresentTime-W)/36e5;k<E&&(q=k),C+=T(G*q),e=x}for(let e=0;e<g.length;e++)if(0,0==g[e]["duration (min)"]||"PumpResume"==g[e]._type){let a=new Date(g[e].timestamp),t=a,r=e;do{if(--r,"TempBasal"==g[r]._type&&r>=0){t=new Date(g[r].timestamp);break}}while(r>0);(t-a)/36e5>0&&(S+=R(t,a))}for(let e=g.length-1;e>0;e--)if("TempBasalDuration"==g[e]._type){let a=g[e]["duration (min)"]/60,t=new Date(g[e].timestamp);var z=t;let r=e;do{if(--r,r>=0&&("TempBasal"==g[r]._type||"PumpSuspend"==g[r]._type)){z=new Date(g[r].timestamp);break}}while(r>0);if(0==e&&"TempBasalDuration"==g[0]._type&&(z=new Date,a=g[e]["duration (min)"]/60),(z-t)/36e5-a>0){S+=R(z,D(t,a))}}y=w+C+S,v=". Bolus insulin: "+w.toPrecision(5)+" U",b=". Temporary basal insulin: "+C.toPrecision(5)+" U",f=". Insulin with scheduled basal rate: "+S.toPrecision(5)+" U",_=M+(". tdd past 24h is: "+y.toPrecision(5)+" U")+v+b+f,tddReason=", TDD: "+n(y,2)+" U. ";const L=e.glucose;var N=h.enableChris,Z=h.enableDynamicCR;const $=i.autosens_min,H=i.autosens_max,J=h.adjustmentFactor,K=i.min_bg;var Q=!1,V="";1!=i.high_temptarget_raises_sensitivity&&1!=i.exercise_mode||(Q=!0),K>=118&&1==Q&&(N=!1,V="Dynamic ISF temporarily off due to a high temp target/exercising. Current min target: "+K);var X=", Dynamic ratios log: ",Y=", AF: "+J+". ",ee="BG: "+L+" mg/dl ("+(.0555*L).toPrecision(2)+" mmol/l). ",ae="";const te=h.curve,re=h.insulinPeakTime,ne=h.useCustomPeakTime;var oe=55;switch(te){case"rapid-acting":oe=55;break;case"ultra-rapid":oe=re<75&&1==ne?120-re:70}if(1==h.useNewFormula){var ie=i.sens*J*y*Math.log(L/oe+1)/1800;ae=", Logarithmic formula. InsulinFactor: "+oe+", "}else{ie=i.sens*J*y*L/277700;ae=", Original formula. "}var se=i.carb_ratio,le="";if(1==N&&y>0){if(le=", Dynamic ISF/CR: On/",ie>H?(V=", Dynamic ISF hit limit by autosens_max setting: "+H+" ("+ie.toPrecision(3)+"), ",ie=H):ie<$&&(V=", Dynamic ISF hit limit by autosens_min setting: "+$+" ("+ie.toPrecision(3)+"). ",ie=$),1==Z){le+="On",se=n(se/ie,2),i.carb_ratio=se;var me=", Dynamic CR: "+se+" g/U"}else{me=" CR: "+se+" g/U";le+="Off"}var ue=i.sens/ie;V+="Dynamic autosens.ratio set to "+ie.toPrecision(3)+" with ISF: "+ue.toPrecision(3)+" mg/dl/U ("+(.0555*ue).toPrecision(3)+" mmol/l/U) and"+me,s.ratio=ie,_+=X+ee+Y+ae+V+le}else _+=0==N&&1==Z?X+ee+Y+ae+"Dynamic ISF is off."+me+le:X+"Dynamic ISF is off. Dynamic CR is off."+le;console.log(_),tddReason+=le+Y+ae;var de={},ce=new Date;if(c&&(ce=c),void 0===i||void 0===i.current_basal)return de.error="Error: could not get current basal rate",de;var ge=r(i.current_basal,i),he=ge,pe=new Date;c&&(pe=c);var fe,ve=new Date(e.date),be=n((pe-ve)/60/1e3,1),Be=e.glucose,Me=e.noise;fe=e.delta>-.5?"+"+n(e.delta,0):n(e.delta,0);var _e=Math.min(e.delta,e.short_avgdelta),xe=Math.min(e.short_avgdelta,e.long_avgdelta),ye=Math.max(e.delta,e.short_avgdelta,e.long_avgdelta);(Be<=10||38===Be||Me>=3)&&(de.reason="CGM is calibrating, in ??? state, or noise is high");if(Be>60&&0==e.delta&&e.short_avgdelta>-1&&e.short_avgdelta<1&&e.long_avgdelta>-1&&e.long_avgdelta<1&&("fakecgm"==e.device?(console.error("CGM data is unchanged ("+o(Be,i)+"+"+o(e.delta,i)+") for 5m w/ "+o(e.short_avgdelta,i)+" mg/dL ~15m change & "+o(e.long_avgdelta,2)+" mg/dL ~45m change"),console.error("Simulator mode detected ("+e.device+"): continuing anyway")):!0),be>12||be<-5?de.reason="If current system time "+pe+" is correct, then BG data is too old. The last BG data was read "+be+"m ago at "+ve:0===e.short_avgdelta&&0===e.long_avgdelta&&(e.last_cal&&e.last_cal<3?de.reason="CGM was just calibrated":de.reason="CGM data is unchanged ("+o(Be,i)+"+"+o(e.delta,i)+") for 5m w/ "+o(e.short_avgdelta,i)+" mg/dL ~15m change & "+o(e.long_avgdelta,i)+" mg/dL ~45m change"),Be<=10||38===Be||Me>=3||be>12||be<-5||0===e.short_avgdelta&&0===e.long_avgdelta)return a.rate>=he?(de.reason+=". Canceling high temp basal of "+a.rate,de.deliverAt=ce,de.temp="absolute",de.duration=0,de.rate=0,de):0===a.rate&&a.duration>30?(de.reason+=". Shortening "+a.duration+"m long zero temp to 30m. ",de.deliverAt=ce,de.temp="absolute",de.duration=30,de.rate=0,de):(de.reason+=". Temp "+a.rate+" <= current basal "+he+"U/hr; doing nothing. ",de);var Ce,we,Se,Ge=i.max_iob;if(void 0!==i.min_bg&&(we=i.min_bg),void 0!==i.max_bg&&(Se=i.max_bg),void 0===i.min_bg||void 0===i.max_bg)return de.error="Error: could not determine target_bg. ",de;Ce=(i.min_bg+i.max_bg)/2;var De=i.exercise_mode||i.high_temptarget_raises_sensitivity,Te=100,Oe=160;if(i.half_basal_exercise_target&&(Oe=i.half_basal_exercise_target),De&&i.temptargetSet&&Ce>Te||i.low_temptarget_lowers_sensitivity&&i.temptargetSet&&Ce<Te){var Ue=Oe-Te;Ue+Ce-Te>0?(sensitivityRatio=Ue/(Ue+Ce-Te),sensitivityRatio=Math.min(sensitivityRatio,i.autosens_max),sensitivityRatio=n(sensitivityRatio,2)):sensitivityRatio=i.autosens_max,process.stderr.write("Sensitivity ratio set to "+sensitivityRatio+" based on temp target of "+Ce+"; ")}else void 0!==s&&s&&(sensitivityRatio=s.ratio,process.stderr.write("Autosens ratio: "+sensitivityRatio+"; "));if(sensitivityRatio&&(he=i.current_basal*sensitivityRatio,(he=r(he,i))!==ge?process.stderr.write("Adjusting basal from "+ge+" to "+he+"; "):process.stderr.write("Basal unchanged: "+he+"; ")),i.temptargetSet);else if(void 0!==s&&s&&(i.sensitivity_raises_target&&s.ratio<1||i.resistance_lowers_target&&s.ratio>1)){we=n((we-60)/s.ratio)+60,Se=n((Se-60)/s.ratio)+60;var Re=n((Ce-60)/s.ratio)+60;Ce===(Re=Math.max(80,Re))?process.stderr.write("target_bg unchanged: "+Re+"; "):process.stderr.write("target_bg from "+Ce+" to "+Re+"; "),Ce=Re}var Ae=200,Ie=200,Fe=200;if(e.noise>=2){var Pe=Math.max(1.1,i.noisyCGMTargetMultiplier);Math.min(250,i.maxRaw);Ae=n(Math.min(200,we*Pe)),Ie=n(Math.min(200,Ce*Pe)),Fe=n(Math.min(200,Se*Pe)),process.stderr.write("Raising target_bg for noisy / raw CGM data, from "+Ce+" to "+Ie+"; "),we=Ae,Ce=Ie,Se=Fe}var je=we-.5*(we-40),qe=n(i.sens,1),Ee=i.sens;if(void 0!==s&&s&&((Ee=n(Ee=i.sens/sensitivityRatio,1))!==qe?process.stderr.write("ISF from "+o(qe,i)+" to "+o(Ee,i)):process.stderr.write("ISF unchanged: "+o(Ee,i)),isfreason+="Autosens ratio: "+n(sensitivityRatio,2)+", ISF: "+o(qe,i)+"â†’"+o(Ee,i)),console.error("CR:"+i.carb_ratio),Ee=autoISF(Ee,Ce,i,e,l,c,s,sensitivityRatio),void 0===t)return de.error="Error: iob_data undefined. ",de;var We,ke=t;if(t.length,t.length>1&&(t=ke[0]),void 0===t.activity||void 0===t.iob)return de.error="Error: iob_data missing some property. ",de;var ze=((We=void 0!==t.lastTemp?n((new Date(pe).getTime()-t.lastTemp.date)/6e4):0)+a.duration)%30;if(console.error("currenttemp:"+a.rate+" lastTempAge:"+We+"m, tempModulus:"+ze+"m"),de.temp="absolute",de.deliverAt=ce,u&&a&&t.lastTemp&&a.rate!==t.lastTemp.rate&&We>10&&a.duration)return de.reason="Warning: currenttemp rate "+a.rate+" != lastTemp rate "+t.lastTemp.rate+" from pumphistory; canceling temp",m.setTempBasal(0,0,i,de,a);if(a&&t.lastTemp&&a.duration>0){var Le=We-t.lastTemp.duration;if(Le>5&&We>10)return de.reason="Warning: currenttemp running but lastTemp from pumphistory ended "+Le+"m ago; canceling temp",m.setTempBasal(0,0,i,de,a)}var Ne=n(-t.activity*Ee*5,2),Ze=n(6*(_e-Ne));Ze<0&&(Ze=n(6*(xe-Ne)))<0&&(Ze=n(6*(e.long_avgdelta-Ne)));var $e=Be,He=($e=t.iob>0?n(Be-t.iob*Ee):n(Be-t.iob*Math.min(Ee,i.sens)))+Ze;if(void 0===He||isNaN(He))return de.error="Error: could not calculate eventualBG. Sensitivity: "+Ee+" Deviation: "+Ze,de;var Je=function(e,a,t){return n(t+(e-a)/24,1)}(Ce,He,Ne);de={temp:"absolute",bg:Be,tick:fe,eventualBG:He,insulinReq:0,reservoir:d,deliverAt:ce,sensitivityRatio};var Ke=[],Qe=[],Ve=[],Xe=[];Ke.push(Be),Qe.push(Be),Xe.push(Be),Ve.push(Be);var Ye=function(e,a,t,r){return a?!e.allowSMB_with_high_temptarget&&e.temptargetSet&&r>100?(console.error("SMB disabled due to high temptarget of",r),!1):!0===t.bwFound&&!1===e.A52_risk_enable?(console.error("SMB disabled due to Bolus Wizard activity in the last 6 hours."),!1):!0===e.enableSMB_always?(t.bwFound?console.error("Warning: SMB enabled within 6h of using Bolus Wizard: be sure to easy bolus 30s before using Bolus Wizard"):console.error("SMB enabled due to enableSMB_always"),!0):!0===e.enableSMB_with_COB&&t.mealCOB?(t.bwCarbs?console.error("Warning: SMB enabled with Bolus Wizard carbs: be sure to easy bolus 30s before using Bolus Wizard"):console.error("SMB enabled for COB of",t.mealCOB),!0):!0===e.enableSMB_after_carbs&&t.carbs?(t.bwCarbs?console.error("Warning: SMB enabled with Bolus Wizard carbs: be sure to easy bolus 30s before using Bolus Wizard"):console.error("SMB enabled for 6h after carb entry"),!0):!0===e.enableSMB_with_temptarget&&e.temptargetSet&&r<100?(t.bwFound?console.error("Warning: SMB enabled within 6h of using Bolus Wizard: be sure to easy bolus 30s before using Bolus Wizard"):console.error("SMB enabled for temptarget of",o(r,e)),!0):(console.error("SMB disabled (no enableSMB preferences active or no condition satisfied)"),!1):(console.error("SMB disabled (!microBolusAllowed)"),!1)}(i,u,l,Ce),ea=i.enableUAM,aa=0,ta=0;aa=n(_e-Ne,1);var ra=n(_e-Ne,1);csf=Ee/i.carb_ratio,console.error("profile.sens:"+o(i.sens,i)+", sens:"+o(Ee,i)+", CSF:"+n(csf,1));var na=n(30*csf*5/60,1);aa>na&&(console.error("Limiting carb impact from "+aa+" to "+na+"mg/dL/5m (30g/h)"),aa=na);var oa=3;sensitivityRatio&&(oa/=sensitivityRatio);var ia=oa;if(l.carbs){oa=Math.max(oa,l.mealCOB/20);var sa=n((new Date(pe).getTime()-l.lastCarbTime)/6e4),la=(l.carbs-l.mealCOB)/l.carbs;ia=n(ia=oa+1.5*sa/60,1),console.error("Last carbs "+sa+" minutes ago; remainingCATime:"+ia+"hours; "+n(100*la)+"% carbs absorbed")}var ma=Math.max(0,aa/5*60*ia/2)/csf,ua=90,da=1;i.remainingCarbsCap&&(ua=Math.min(90,i.remainingCarbsCap)),i.remainingCarbsFraction&&(da=Math.min(1,i.remainingCarbsFraction));var ca=1-da,ga=Math.max(0,l.mealCOB-ma-l.carbs*ca),ha=(ga=Math.min(ua,ga))*csf*5/60/(ia/2),pa=n(l.slopeFromMaxDeviation,2),fa=n(l.slopeFromMinDeviation,2),va=Math.min(pa,-fa/3),ba=0;0===aa?ta=0:!0===i.floating_carbs?(ta=Math.min(60*ia/5/2,Math.max(0,l.carbs*csf/aa)),ba=Math.min(60*ia/5/2,Math.max(0,l.mealCOB*csf/aa)),l.carbs>0&&(isfreason+=", Floating Carbs:, CID: "+n(ta,1)+", MealCarbs: "+n(l.carbs,1)+", Not Floating:, CID: "+n(ba,1)+", MealCOB: "+n(l.mealCOB,1),console.error("Floating Carbs CID: "+n(ta,1)+" / MealCarbs: "+n(l.carbs,1)+" vs. Not Floating:"+n(ba,1)+" / MealCOB:"+n(l.mealCOB,1)))):ta=Math.min(60*ia/5/2,Math.max(0,l.mealCOB*csf/aa)),console.error("Carb Impact:"+aa+"mg/dL per 5m; CI Duration:"+n(5*ta/60*2,1)+"hours; remaining CI ("+ia/2+"h peak):",n(ha,1)+"mg/dL per 5m");var Ba,Ma,_a,xa,ya,Ca=999,wa=999,Sa=999,Ga=Be,Da=999,Ta=999,Oa=999,Ua=999,Ra=He,Aa=Be,Ia=Be,Fa=0,Pa=[],ja=[];try{ke.forEach((function(e){var a=n(-e.activity*Ee*5,2),t=n(-e.iobWithZeroTemp.activity*Ee*5,2),r=aa*(1-Math.min(1,Qe.length/12));Ra=Qe[Qe.length-1]+a+r;var o=Xe[Xe.length-1]+t,i=Math.max(0,Math.max(0,aa)*(1-Ke.length/Math.max(2*ta,1))),s=Math.min(Ke.length,12*ia-Ke.length),l=Math.max(0,s/(ia/2*12)*ha);i+l,Pa.push(n(l,0)),ja.push(n(i,0)),COBpredBG=Ke[Ke.length-1]+a+Math.min(0,r)+i+l;var m=Math.max(0,ra+Ve.length*va),u=Math.max(0,ra*(1-Ve.length/Math.max(36,1))),d=Math.min(m,u);d>0&&(Fa=n(5*(Ve.length+1)/60,1)),UAMpredBG=Ve[Ve.length-1]+a+Math.min(0,r)+d,Qe.length<48&&Qe.push(Ra),Ke.length<48&&Ke.push(COBpredBG),Ve.length<48&&Ve.push(UAMpredBG),Xe.length<48&&Xe.push(o),COBpredBG<Da&&(Da=n(COBpredBG)),UAMpredBG<Ta&&(Ta=n(UAMpredBG)),Ra<Oa&&(Oa=n(Ra)),o<Ua&&(Ua=n(o));Qe.length>18&&Ra<Ca&&(Ca=n(Ra)),Ra>Aa&&(Aa=Ra),(ta||ha>0)&&Ke.length>18&&COBpredBG<wa&&(wa=n(COBpredBG)),(ta||ha>0)&&COBpredBG>Aa&&(Ia=COBpredBG),ea&&Ve.length>12&&UAMpredBG<Sa&&(Sa=n(UAMpredBG)),ea&&UAMpredBG>Aa&&UAMpredBG}))}catch(e){console.error("Problem with iobArray.  Optional feature Advanced Meal Assist disabled")}l.mealCOB&&(console.error("predCIs (mg/dL/5m):"+ja.join(" ")),console.error("remainingCIs:      "+Pa.join(" "))),de.predBGs={},Qe.forEach((function(e,a,t){t[a]=n(Math.min(401,Math.max(39,e)))}));for(var qa=Qe.length-1;qa>12&&Qe[qa-1]===Qe[qa];qa--)Qe.pop();for(de.predBGs.IOB=Qe,_a=n(Qe[Qe.length-1]),Xe.forEach((function(e,a,t){t[a]=n(Math.min(401,Math.max(39,e)))})),qa=Xe.length-1;qa>6&&!(Xe[qa-1]>=Xe[qa]||Xe[qa]<=Ce);qa--)Xe.pop();if(de.predBGs.ZT=Xe,n(Xe[Xe.length-1]),l.mealCOB>0&&(aa>0||ha>0)){for(Ke.forEach((function(e,a,t){t[a]=n(Math.min(401,Math.max(39,e)))})),qa=Ke.length-1;qa>12&&Ke[qa-1]===Ke[qa];qa--)Ke.pop();de.predBGs.COB=Ke,xa=n(Ke[Ke.length-1]),He=Math.max(He,n(Ke[Ke.length-1]))}if(aa>0||ha>0){if(ea){for(Ve.forEach((function(e,a,t){t[a]=n(Math.min(401,Math.max(39,e)))})),qa=Ve.length-1;qa>12&&Ve[qa-1]===Ve[qa];qa--)Ve.pop();de.predBGs.UAM=Ve,ya=n(Ve[Ve.length-1]),Ve[Ve.length-1]&&(He=Math.max(He,n(Ve[Ve.length-1])))}de.eventualBG=He}console.error("UAM Impact:"+ra+"mg/dL per 5m; UAM Duration:"+Fa+"hours"),Ca=Math.max(39,Ca),wa=Math.max(39,wa),Sa=Math.max(39,Sa),Ba=n(Ca);var Ea=l.mealCOB/l.carbs;Ma=n(Sa<999&&wa<999?(1-Ea)*UAMpredBG+Ea*COBpredBG:wa<999?(Ra+COBpredBG)/2:Sa<999?(Ra+UAMpredBG)/2:Ra),Ua>Ma&&(Ma=Ua),Ga=n(Ga=ta||ha>0?ea?Ea*Da+(1-Ea)*Ta:Da:ea?Ta:Oa);var Wa=Sa;if(Ua<je)Wa=(Sa+Ua)/2;else if(Ua<Ce){var ka=(Ua-je)/(Ce-je);Wa=(Sa+(Sa*ka+Ua*(1-ka)))/2}else Ua>Sa&&(Wa=(Sa+Ua)/2);if(Wa=n(Wa),l.carbs)if(!ea&&wa<999)Ba=n(Math.max(Ca,wa));else if(wa<999){var za=Ea*wa+(1-Ea)*Wa;Ba=n(Math.max(Ca,wa,za))}else Ba=ea?Wa:Ga;else ea&&(Ba=n(Math.max(Ca,Wa)));Ba=Math.min(Ba,Ma),process.stderr.write("minPredBG: "+Ba+" minIOBPredBG: "+Ca+" minZTGuardBG: "+Ua),wa<999&&process.stderr.write(" minCOBPredBG: "+wa),Sa<999&&process.stderr.write(" minUAMPredBG: "+Sa),console.error(" avgPredBG:"+Ma+" COB/Carbs:"+l.mealCOB+"/"+l.carbs),Ia>Be&&(Ba=Math.min(Ba,Ia)),de.COB=l.mealCOB,de.IOB=t.iob,de.BGI=o(Ne,i),de.deviation=o(Ze,i),de.ISF=o(Ee,i),de.CR=n(i.carb_ratio,2),de.target_bg=o(Ce,i),de.tdd=n(y,2),de.reason=isfreason+", COB: "+de.COB+", Dev: "+de.deviation+", BGI: "+de.BGI+", CR: "+de.CR+", Target: "+de.target_bg+", minPredBG "+o(Ba,i)+", minGuardBG "+o(Ga,i)+", IOBpredBG "+o(_a,i)+tddReason,xa>0&&(de.reason+=", COBpredBG "+o(xa,i)),ya>0&&(de.reason+=", UAMpredBG "+o(ya,i)),de.reason+="; ";var La=$e;La<40&&(La=Math.min(Ga,La));var Na,Za=je-La,$a=240,Ha=240;if(l.mealCOB>0&&(aa>0||ha>0)){for(qa=0;qa<Ke.length;qa++)if(Ke[qa]<we){$a=5*qa;break}for(qa=0;qa<Ke.length;qa++)if(Ke[qa]<je){Ha=5*qa;break}}else{for(qa=0;qa<Qe.length;qa++)if(Qe[qa]<we){$a=5*qa;break}for(qa=0;qa<Qe.length;qa++)if(Qe[qa]<je){Ha=5*qa;break}}Ye&&Ga<je&&(console.error("minGuardBG "+o(Ga,i)+" projected below "+o(je,i)+" - disabling SMB"),Ye=!1),void 0===i.maxDelta_bg_threshold&&(Na=.2),void 0!==i.maxDelta_bg_threshold&&(Na=Math.min(i.maxDelta_bg_threshold,.4)),ye>Na*Be&&(console.error("maxDelta "+o(ye,i)+" > "+100*Na+"% of BG "+o(Be,i)+" - disabling SMB"),de.reason+="maxDelta "+o(ye,i)+" > "+100*Na+"% of BG "+o(Be,i)+" - SMB disabled!, ",Ye=!1),console.error("BG projected to remain above "+o(we,i)+" for "+$a+"minutes"),(Ha<240||$a<60)&&console.error("BG projected to remain above "+o(je,i)+" for "+Ha+"minutes");var Ja=Ha,Ka=i.current_basal*Ee*Ja/60,Qa=Math.max(0,l.mealCOB-.25*l.carbs),Va=(Za-Ka)/csf-Qa;Ka=n(Ka),Va=n(Va),console.error("naive_eventualBG:"+$e+" bgUndershoot:"+Za+" zeroTempDuration:"+Ja+" zeroTempEffect:"+Ka+" carbsReq:"+Va),Va>=i.carbsReqThreshold&&Ha<=45&&(de.carbsReq=Va,de.reason+=Va+" add'l carbs req w/in "+Ha+"m; ");var Xa=0;if(Be<je&&t.iob<20*-i.current_basal/60&&_e>0&&_e>Je)de.reason+="IOB "+t.iob+" < "+n(20*-i.current_basal/60,2),de.reason+=" and minDelta "+o(_e,i)+" > expectedDelta "+o(Je,i)+"; ";else if(Be<je||Ga<je)return de.reason+="minGuardBG "+o(Ga,i)+"<"+o(je,i),Xa=n(60*((Za=Ce-Ga)/Ee)/i.current_basal),Xa=30*n(Xa/30),Xa=Math.min(120,Math.max(30,Xa)),m.setTempBasal(0,Xa,i,de,a);if(i.skip_neutral_temps&&de.deliverAt.getMinutes()>=55)return de.reason+="; Canceling temp at "+de.deliverAt.getMinutes()+"m past the hour. ",m.setTempBasal(0,0,i,de,a);var Ya=0,et=he;if(He<we){if(de.reason+="Eventual BG "+o(He,i)+" < "+o(we,i),_e>Je&&_e>0&&!Va)return $e<40?(de.reason+=", naive_eventualBG < 40. ",m.setTempBasal(0,30,i,de,a)):(e.delta>_e?de.reason+=", but Delta "+o(fe,i)+" > expectedDelta "+o(Je,i):de.reason+=", but Min. Delta "+_e.toFixed(2)+" > Exp. Delta "+o(Je,i),a.duration>15&&r(he,i)===r(a.rate,i)?(de.reason+=", temp "+a.rate+" ~ req "+he+"U/hr. ",de):(de.reason+="; setting current basal of "+he+" as temp. ",m.setTempBasal(he,30,i,de,a)));Ya=n(Ya=2*Math.min(0,(He-Ce)/Ee),2);var at=Math.min(0,($e-Ce)/Ee);if(at=n(at,2),_e<0&&_e>Je)Ya=n(Ya*(_e/Je),2);if(et=r(et=he+2*Ya,i),a.duration*(a.rate-he)/60<Math.min(Ya,at)-.3*he)return de.reason+=", "+a.duration+"m@"+a.rate.toFixed(2)+" is a lot less than needed. ",m.setTempBasal(et,30,i,de,a);if(void 0!==a.rate&&a.duration>5&&et>=.8*a.rate)return de.reason+=", temp "+a.rate+" ~< req "+et+"U/hr. ",de;if(et<=0){if((Xa=n(60*((Za=Ce-$e)/Ee)/i.current_basal))<0?Xa=0:(Xa=30*n(Xa/30),Xa=Math.min(120,Math.max(0,Xa))),Xa>0)return de.reason+=", setting "+Xa+"m zero temp. ",m.setTempBasal(et,Xa,i,de,a)}else de.reason+=", setting "+et+"U/hr. ";return m.setTempBasal(et,30,i,de,a)}if(_e<Je&&(!u||!Ye))return e.delta<_e?de.reason+="Eventual BG "+o(He,i)+" > "+o(we,i)+" but Delta "+o(fe,i)+" < Exp. Delta "+o(Je,i):de.reason+="Eventual BG "+o(He,i)+" > "+o(we,i)+" but Min. Delta "+_e.toFixed(2)+" < Exp. Delta "+o(Je,i),a.duration>15&&r(he,i)===r(a.rate,i)?(de.reason+=", temp "+a.rate+" ~ req "+he+"U/hr. ",de):(de.reason+="; setting current basal of "+he+" as temp. ",m.setTempBasal(he,30,i,de,a));if(Math.min(He,Ba)<Se&&(!u||!Ye))return de.reason+=o(He,i)+"-"+o(Ba,i)+" in range: no temp required",a.duration>15&&r(he,i)===r(a.rate,i)?(de.reason+=", temp "+a.rate+" ~ req "+he+"U/hr. ",de):(de.reason+="; setting current basal of "+he+" as temp. ",m.setTempBasal(he,30,i,de,a));if(He>=Se&&(de.reason+="Eventual BG "+o(He,i)+" >= "+o(Se,i)+", "),t.iob>Ge)return de.reason+="IOB "+n(t.iob,2)+" > max_iob "+Ge,a.duration>15&&r(he,i)===r(a.rate,i)?(de.reason+=", temp "+a.rate+" ~ req "+he+"U/hr. ",de):(de.reason+="; setting current basal of "+he+" as temp. ",m.setTempBasal(he,30,i,de,a));(Ya=n((Math.min(Ba,He)-Ce)/Ee,2))>Ge-t.iob&&(de.reason+="max_iob "+Ge+", ",Ya=Ge-t.iob),et=r(et=he+2*Ya,i),Ya=n(Ya,3),de.insulinReq=Ya;var tt=n((new Date(pe).getTime()-t.lastBolusTime)/6e4,1);if(u&&Ye&&Be>je){var rt=n(l.mealCOB/i.carb_ratio,3);if(i.use_autoisf)nt=i.smb_max_range_extension;else{console.error("autoISF disabled, SMB range extension disabled");var nt=1}nt>1&&console.error("SMB max range extended from default by factor "+nt);var ot=0;void 0===i.maxSMBBasalMinutes?(ot=n(nt*i.current_basal*30/60,1),console.error("profile.maxSMBBasalMinutes undefined: defaulting to 30m")):t.iob>rt&&t.iob>0?(console.error("IOB",t.iob,"> COB",l.mealCOB+"; mealInsulinReq =",rt),i.maxUAMSMBBasalMinutes?(console.error("profile.maxUAMSMBBasalMinutes:",i.maxUAMSMBBasalMinutes,"profile.current_basal:",i.current_basal),ot=n(nt*i.current_basal*i.maxUAMSMBBasalMinutes/60,1)):(console.error("profile.maxUAMSMBBasalMinutes undefined: defaulting to 30m"),ot=n(30*i.current_basal/60,1))):(console.error("profile.maxSMBBasalMinutes:",i.maxSMBBasalMinutes,"profile.current_basal:",i.current_basal),ot=n(nt*i.current_basal*i.maxSMBBasalMinutes/60,1));var it=i.bolus_increment,st=1/it;if(i.use_autoisf)var lt=determine_varSMBratio(i,Be,Ce);else console.error("autoISF disabled, don't adjust SMB Delivery Ratio"),lt=.5;lt>.5&&console.error("SMB Delivery Ratio increased from default 0.5 to "+n(lt,2));var mt=Math.min(Ya*lt,ot);mt=Math.floor(mt*st)/st,Xa=n(60*((Ce-($e+Ca)/2)/Ee)/i.current_basal),Ya>0&&mt<it&&(Xa=0);var ut=0;Xa<=0?Xa=0:Xa>=30?(Xa=30*n(Xa/30),Xa=Math.min(60,Math.max(0,Xa))):(ut=n(he*Xa/30,2),Xa=30),de.reason+=" insulinReq "+Ya,mt>=ot&&(de.reason+="; maxBolus "+ot),Xa>0&&(de.reason+="; setting "+Xa+"m low temp of "+ut+"U/h"),de.reason+=". ";var dt=3;i.SMBInterval&&(dt=Math.min(10,Math.max(1,i.SMBInterval)));var ct=n(dt-tt,0),gt=n(60*(dt-tt),0)%60;if(console.error("naive_eventualBG",$e+",",Xa+"m "+ut+"U/h temp needed; last bolus",tt+"m ago; maxBolus: "+ot),tt>dt?mt>0&&(de.units=mt,de.reason+="Microbolusing "+mt+"U. "):de.reason+="Waiting "+ct+"m "+gt+"s to microbolus again. ",Xa>0)return de.rate=ut,de.duration=Xa,de}var ht=m.getMaxSafeBasal(i);return et>ht&&(de.reason+="adj. req. rate: "+et+" to maxSafeBasal: "+ht+", ",et=r(ht,i)),a.duration*(a.rate-he)/60>=2*Ya?(de.reason+=a.duration+"m@"+a.rate.toFixed(2)+" > 2 * insulinReq. Setting temp basal of "+et+"U/hr. ",m.setTempBasal(et,30,i,de,a)):void 0===a.duration||0===a.duration?(de.reason+="no temp, setting "+et+"U/hr. ",m.setTempBasal(et,30,i,de,a)):a.duration>5&&r(et,i)<=r(a.rate,i)?(de.reason+="temp "+a.rate+" >~ req "+et+"U/hr. ",de):(de.reason+="temp "+a.rate+"<"+et+"U/hr. ",m.setTempBasal(et,30,i,de,a))}},6880:(e,a,t)=>{var r=t(6654);e.exports=function(e,a){var t=20;void 0!==a&&"string"==typeof a.model&&(r(a.model,"54")||r(a.model,"23"))&&(t=40);return e<1?Math.round(e*t)/t:e<10?Math.round(20*e)/20:Math.round(10*e)/10}},2705:(e,a,t)=>{var r=t(5639).Symbol;e.exports=r},9932:e=>{e.exports=function(e,a){for(var t=-1,r=null==e?0:e.length,n=Array(r);++t<r;)n[t]=a(e[t],t,e);return n}},9750:e=>{e.exports=function(e,a,t){return e==e&&(void 0!==t&&(e=e<=t?e:t),void 0!==a&&(e=e>=a?e:a)),e}},4239:(e,a,t)=>{var r=t(2705),n=t(9607),o=t(2333),i=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":i&&i in Object(e)?n(e):o(e)}},531:(e,a,t)=>{var r=t(2705),n=t(9932),o=t(1469),i=t(3448),s=r?r.prototype:void 0,l=s?s.toString:void 0;e.exports=function e(a){if("string"==typeof a)return a;if(o(a))return n(a,e)+"";if(i(a))return l?l.call(a):"";var t=a+"";return"0"==t&&1/a==-Infinity?"-0":t}},7561:(e,a,t)=>{var r=t(7990),n=/^\s+/;e.exports=function(e){return e?e.slice(0,r(e)+1).replace(n,""):e}},1957:(e,a,t)=>{var r="object"==typeof t.g&&t.g&&t.g.Object===Object&&t.g;e.exports=r},9607:(e,a,t)=>{var r=t(2705),n=Object.prototype,o=n.hasOwnProperty,i=n.toString,s=r?r.toStringTag:void 0;e.exports=function(e){var a=o.call(e,s),t=e[s];try{e[s]=void 0;var r=!0}catch(e){}var n=i.call(e);return r&&(a?e[s]=t:delete e[s]),n}},2333:e=>{var a=Object.prototype.toString;e.exports=function(e){return a.call(e)}},5639:(e,a,t)=>{var r=t(1957),n="object"==typeof self&&self&&self.Object===Object&&self,o=r||n||Function("return this")();e.exports=o},7990:e=>{var a=/\s/;e.exports=function(e){for(var t=e.length;t--&&a.test(e.charAt(t)););return t}},6654:(e,a,t)=>{var r=t(9750),n=t(531),o=t(554),i=t(9833);e.exports=function(e,a,t){e=i(e),a=n(a);var s=e.length,l=t=void 0===t?s:r(o(t),0,s);return(t-=a.length)>=0&&e.slice(t,l)==a}},1469:e=>{var a=Array.isArray;e.exports=a},3218:e=>{e.exports=function(e){var a=typeof e;return null!=e&&("object"==a||"function"==a)}},7005:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},3448:(e,a,t)=>{var r=t(4239),n=t(7005);e.exports=function(e){return"symbol"==typeof e||n(e)&&"[object Symbol]"==r(e)}},8601:(e,a,t)=>{var r=t(4841),n=1/0;e.exports=function(e){return e?(e=r(e))===n||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}},554:(e,a,t)=>{var r=t(8601);e.exports=function(e){var a=r(e),t=a%1;return a==a?t?a-t:a:0}},4841:(e,a,t)=>{var r=t(7561),n=t(3218),o=t(3448),i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,l=/^0o[0-7]+$/i,m=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return NaN;if(n(e)){var a="function"==typeof e.valueOf?e.valueOf():e;e=n(a)?a+"":a}if("string"!=typeof e)return 0===e?e:+e;e=r(e);var t=s.test(e);return t||l.test(e)?m(e.slice(2),t?2:8):i.test(e)?NaN:+e}},9833:(e,a,t)=>{var r=t(531);e.exports=function(e){return null==e?"":r(e)}}},a={};function t(r){var n=a[r];if(void 0!==n)return n.exports;var o=a[r]={exports:{}};return e[r](o,o.exports,t),o.exports}t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();var r=t(4635);freeaps_determineBasal=r})();